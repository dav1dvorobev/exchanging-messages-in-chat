
# Программный комплекс для обмена сообщениями в чате

## Описание проекта

Данный проект представляет собой программный комплекс, реализованный на языке программирования C++, который обеспечивает обмен сообщениями между пользователями через компьютерную сеть в общем чате. Каждый участник видит сообщения всех остальных участников.

## Функциональные требования

### 1. Чтение конфигурационного файла

Клиентская часть читает конфигурационный файл `config.json`, для настройки определенных параметров. Конфигурационный файл содержит изменяемые параметры, такие как адрес и порт сервера, путь к лог-файлу, колличество последних сообщений.

Пример структуры конфигурационного файла:
```json
{
	"server_address": "127.0.0.1",
	"port": 8080,
	"logging_path": "client.log",
	"preload_history": 10
}
```

### 2. Авторизация при подключении

При подключении к чату осуществляется авторизация. Участники должны использовать только определенные логины и пароли для входа в чат, хранящиеся в файле `users.json`.

Пример организации данных:
```json
{
	"thedeepestreality": "5y3k",
	"spogozhev": "uts7d",
	"dav1dvorobev": "q8hp7"
}
```

### 3. Фиксация событий в лог-файле

Каждое событие, происходящее в чате, зафиксировано в лог-файле с указанием временной метки. Лог-файл необходим для расследования инцидентов в случае ошибок.

Пример записи в лог-файле:
```
[14-11-2023 01:28:02] [INFO] SERVER START IN PORT 8080
[14-11-2023 13:12:38] [ERROR] FAILED BIND
```

### 4. Валидация сообщений

Для каждого сообщения осуществляется проверка на формат. Сообщение считается допустимым, если представляет собой строку длиной не более 64 символов, содержащую только символы с кодом >= 32 и завершающуюся одним из символов: `.!?`.

# Работа серверной части. Класс ServerSocket

`ServerSocket` - это класс для создания серверного сокета. На этапе инициализации происходят все необходимые привязки и настройки для дальнейшей работы сервера и прослушивания входящих соединений.

### Конструктор
```cpp
ServerSocket(int __port = 8080)
```
Создаёт объект `ServerSocket` и привязывает его к указанному порту. По умолчанию используется порт 8080.
## Методы:
```cpp
int acceptConnection() const
```
Принимает входящее соединение и возвращает файловый дескриптор клиентского сокета.

```cpp
int port() const
```
Возвращает порт, к которому привязан серверный сокет.

```cpp
~ServerSocket()
```
Освобождает ресурсы, закрывает серверный сокет.

Методы класса могут генерировать исключения типа `std::runtime_error` в случае возникновения ошибок при создании сокета, привязки к порту, прослушивания или принятия соединения.

### Пример использования:
Убедитесь, что подключен заголовочный файл `ServerSocket.h`.

```cpp
try {
    ServerSocket server(8080);
    int clientSocket = server.acceptConnection();
    // ... использование clientSocket для взаимодействия с клиентом ...
} catch (const std::runtime_error& e) {
    std::cerr << "Ошибка: " << e.what() << std::endl;
}
```

# Работа клиентской части. Класс SocketShell

`SocketShell` - представляет собой оболочку для работы с сокетами в среде сокетов в стиле Unix. Он позволяет устанавливать соединение с удаленным сервером и осуществлять отправку и прием данных через сокет.

## Конструкторы

```cpp
SocketShell(int __clientSocket = -1)
```
Конструктор по умолчанию. Создает экземпляр объекта `SocketShell` с клиентским сокетом, который по умолчанию равен -1.

```cpp
SocketShell(std::string __address, int __port)
```

Конструктор, устанавливающий соединение с удаленным сервером. Принимает строковый параметр `__address`, представляющий IP-адрес сервера, и целочисленный параметр `__port`, представляющий порт сервера. Создает сокет и пытается установить соединение с указанным сервером. Если соединение не удалось, выбрасывает исключение `std::runtime_error`.

## Методы

```cpp
operator int() const
```
Перегруженный оператор преобразования в `int`. Позволяет получить дескриптор сокета.

## Глобальные функции
```cpp
std::string readString(const SocketShell& __fd)
```
Функция для чтения данных из сокета. Принимает ссылку на объект `SocketShell` и возвращает строку, прочитанную из сокета. Если чтение не удалось или было прочитано 0 байт, выбрасывает исключение `std::runtime_error`.

```cpp
void sendString(const SocketShell& __fd, const std::string& __buf)
```
Функция для отправки данных через сокет. Принимает ссылку на объект `SocketShell` и строку `__buf` для отправки. Если отправка не удалась, выбрасывает исключение `std::runtime_error`.

## Пример использования
Убедитесь, что подключен заголовочный файл `SocketShell.h`.
```cpp
SocketShell clientSocket("127.0.0.1", 8080);
sendString(clientSocket, "Hello, server!");
std::string response = readString(clientSocket);
```
## Сборка и запуск

### 1. Установка библиотеки для парсинга JSON

Для парсинга JSON в проекте используется библиотека [nlohmann/json](https://github.com/nlohmann/json). Для её установки выполните следующую команду:
Для Linux (Ubuntu):
```bash
sudo apt-get install nlohmann-json3-dev
```
**Для других операционных систем или сред** [инструкция по установке](https://json.nlohmann.me/integration/package_managers/)

### 2. Запуск приложения

После успешной установки библиотеки, вы сможете последовательно запустить серверную и клиентскую часть.
```bash
cd src/ && g++ server.cpp -o server -pthread && ./server
```
```bash
cd src/ && g++ client.cpp -o client -pthread && ./client
```
Убедитесь, что все необходимые компоненты установлены, и следуйте инструкциям в консоли для входа в чат и начала обмена сообщениями.